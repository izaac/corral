name: registry
description: |
  An authenticated docker registry running in Linode.
variables:
  linode_token:
    sensitive: true
    type: string
    optional: false
    description: "A Linode API token with write permission."
  linode_root_password:
    sensitive: true
    type: string
    optional: false
    description: "The Linodes default root password"
  aws_zone_id:
    sensitive: true
    type: string
    optional: false
    description: "The domain Route53 zone id"
  aws_domain:
    sensitive: true
    type: string
    optional: false
    description: "The domain to use for the registry host."
  registry_host:
    type: string
    readOnly: true
    description: "host the configured registry can be accessed at"
  username:
    type: string
    readOnly: true
    description: "username for registry authentication"
  password:
    type: string
    readOnly: true
    description: "password for registry authentication"
  valid_cert:
    type: string
    optional: false
    description: "valid domain certificate"
  valid_key:
    type: string
    optional: false
    description: "valid domain certificate key"
  rancher_version:
    type: string
    optional: false
    description: "Rancher version that the registry is for"
  rancher_password:
    type: string
    optional: false
    description: "Rancher password after bootstrap"
  ssh_authorized_key:
    type: string
    optional: true
    description: "the public ssh key to copy to the nodes for remote access"
  docker_version:
    type: string
    optional: false
    default: "20.10"
    description: "docker version to use for the Rancher install"
  kubernetes_version:
    type: string
    optional: true
    default: "v1.24.8+rke2r1"
    description: "downstream RKE2 clusters kubernetes version"
  kubernetes_version_rke1:
    type: string
    optional: true
    default: "v1.24.6-rancher1-1"
    description: "downstream RKE1 clusters kubernetes version"
  linode_resource_prefix:
    type: string
    optional: false
    description: "The prefix used on deployed Linode resources"
commands:
  - module: registry
  - command: /opt/corral/registry-install.sh
    node_pools:
      - registry
  - module: rancher
  - command: /opt/corral/rancher-info.sh
    node_pools:
      - rancher